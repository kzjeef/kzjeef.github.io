<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Thinking beyond source code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Thinking beyond source code">
<meta property="og:url" content="http://www.thinksrc.com/page/7/index.html">
<meta property="og:site_name" content="Thinking beyond source code">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Thinking beyond source code">
  
    <link rel="alternate" href="/atom.xml" title="Thinking beyond source code" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Thinking beyond source code</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Recording my throughs</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.thinksrc.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-how-can-we-avoid-deletecreate-inconsistency" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/11/29/how-can-we-avoid-deletecreate-inconsistency.html" class="article-date">
  <time datetime="2009-11-29T09:09:00.000Z" itemprop="datePublished">2009-11-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/11/29/how-can-we-avoid-deletecreate-inconsistency.html">How can we avoid delete/create inconsistency?</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is a file system note: @MIT 6.824 2006 Lecture 6</p>
<p>Think this satiation,</p>
<p>unlink("f1"); <br>create("f2"); <br>Create happens to re-use the i-node freed by the unlink. <br>suppose only create write goes to disk, but none of the unlink's writes.</p>
<p>Crash.</p>
<p>After re-start, what does recovery see?</p>
<p>The file system looks correct! Nothing to fix! <br>But file f1 actually has file f2's contents!</p>
<p>Serious *undetected* inconsisency.</p>
<p>This is *not* a state the file system counld have been in if the crash had occured slightly earlier or later. And fsck did not notify the user there was an unfixable problem!</p>
<p><em>How can we avoid this delete/create inconsistency?</em></p>
<p>Observation: We only care about what's visible in the file system tree.</p>
<p>Goal: on-disk directory entry must always point to correct on-disk i-node.</p>
<p>Unlink Rule: remove dirent *on disk* before freeing i-node.</p>
<p>Create Rule: initialize new i-node *on disk* before creating directory entry.</p>
<p>In general, directory entry writes should be commit points. <br>Crash just before leves us with unused allocated i-node. <br>Crash just after is fine.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2009/11/29/how-can-we-avoid-deletecreate-inconsistency.html" data-id="cj4nt09ip002qusa6zpdb8a5h" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-%e6%84%9f%e5%86%92%e4%ba%86%ef%bc%8c%e7%bf%bb%e5%a2%99%e4%ba%86" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/11/16/%e6%84%9f%e5%86%92%e4%ba%86%ef%bc%8c%e7%bf%bb%e5%a2%99%e4%ba%86.html" class="article-date">
  <time datetime="2009-11-15T23:56:00.000Z" itemprop="datePublished">2009-11-16</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/11/16/%e6%84%9f%e5%86%92%e4%ba%86%ef%bc%8c%e7%bf%bb%e5%a2%99%e4%ba%86.html">感冒了，翻墙了</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>冬天气温降的很快，就连以往冬天不那么冷的广东，这次都很冷很冷了。我都感冒了， 不过不是猪流感。</p>
<p>还有一件事就是使用ssh tunnel翻墙了，很爽阿。</p>
<p>赞一个OpenSSH。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2009/11/16/%e6%84%9f%e5%86%92%e4%ba%86%ef%bc%8c%e7%bf%bb%e5%a2%99%e4%ba%86.html" data-id="cj4nt09im002musa66r1sfw7j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-find-%e6%b8%85%e7%90%86%e4%bd%a0%e7%9a%84%e7%a1%ac%e7%9b%98" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/09/11/find-%e6%b8%85%e7%90%86%e4%bd%a0%e7%9a%84%e7%a1%ac%e7%9b%98.html" class="article-date">
  <time datetime="2009-09-10T16:13:00.000Z" itemprop="datePublished">2009-09-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/09/11/find-%e6%b8%85%e7%90%86%e4%bd%a0%e7%9a%84%e7%a1%ac%e7%9b%98.html">Find, 清理你的硬盘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>最近因为几份庞大的代码， 动则几个G的空间就没有了。 在我的Linux上分区实在不够，但是又不舍得删一些720P的电影， 只好想尽办法来清理硬盘上的垃圾。</p>
<p>有了GNU的工具链，这个就非常容易。</p>
<p>cd /<br>find -size +100M -print</p>
<p>有了这条就可以找到大于100M的文件，于是我找到一堆不需要的压缩包。 删之。 空间剧增。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2009/09/11/find-%e6%b8%85%e7%90%86%e4%bd%a0%e7%9a%84%e7%a1%ac%e7%9b%98.html" data-id="cj4nt09ik002kusa6lufm2tx9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-ssh-without-typing-passwd" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/05/23/ssh-without-typing-passwd.html" class="article-date">
  <time datetime="2009-05-23T07:21:00.000Z" itemprop="datePublished">2009-05-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/05/23/ssh-without-typing-passwd.html">Ssh without typing passwd</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Blogspot被墙了，只好发到这里了。</p>
<p>在公司的时候，总是有这样的需求：你需要ssh或者scp东西到别人的机器上面，有时候会比较频繁，但是每次都得你的目标机的人过来输一下密码，很麻烦，效率也很低。</p>
<p>在看一篇hadoop的<a href="http://www.ibm.com/developerworks/cn/opensource/os-cn-hadoop3/" target="_blank" rel="external">文章</a>的时候看到了一些ssh，和公钥的用法（唉，没办法，比较土，现在才知道），可以避免输密码。</p>
<p>我这里就直接抄下来了，版权都在原作者.</p>
<blockquote style="MARGIN-RIGHT: 0px" dir="ltr"><p>使用三台机器，机器名分别为 homer06, homer07, homer08，均安装 Redhat Enterprise Linux 5.0 (其它 Linux 发行版亦可), 确保各台机器之间网络畅通，机器名与 IP 地址之间解析正确，从任一台机器都可以　ping 通其它机器的机器名。如有机器名的解析问题，可通过设置 /etc/hosts 文件解决，当然更好的解决方法是在你的网络中配置 DNS 服务器。此外，需要在三台机器上创建相同的用户帐号，如 caoyuz, 或直接使用 root 帐号亦可。</p>
<p>在 Hadoop 分布式环境中，Name Node (主节点) 需要通过 SSH 来启动和停止 Data Node (从结点)上的各类进程。我们需要保证环境中的各台机器均可以通过 SSH 登录访问，并且 Name Node 用 SSH 登录 Data Node 时，不需要输入密码，这样 Name Node 才能在后台自如地控制其它结点。可以将各台机器上的 SSH 配置为使用无密码公钥认证方式来实现。</p>
<p>现在流行的各类 Linux 发行版一般都安装了 SSH　协议的开源实现 OpenSSH, 并且已经启动了 SSH 服务, 即这些机器缺省应该就是支持 SSH 登录的。如果你的机器缺省不支持 SSH, 请下载安装 OpenSSH。</p>
<p>以下是配置 SSH 的无密码公钥认证的过程。首先，在 homer06 机器上执行命令，如代码清单 1 所示：</p>
<p><a name="listing3" id="listing3"><strong>代码清单1</strong></a></p>
<table cellpadding="0" width="100%" border="0" cellspacing="0">
<tbody>
<tr>
<td class="code-outline">
<pre class="displaycode"><br> <br>homer06: $ ssh-keygen -t rsa<br>Generating public/private rsa key pair.<br>Enter file in which to save the key (/home/caoyuz/.ssh/id_rsa): <br>Enter passphrase (empty for no passphrase):<br>Enter same passphrase again:<br>Your identification has been saved in /home/caoyuz/.ssh/id_rsa.<br>Your public key has been saved in /home/caoyuz/.ssh/id_rsa.pub.<br>The key fingerprint is:<br>2e:57:e2:bf:fd:d4:45:5c:a7:51:3d:f1:51:3c:69:68 root@krusty04<br></pre>
<p></p></td>
</tr>
</tbody>
</table>
<p>
</p><p>这个命令将为 homer06 上的当前用户 caoyuz 生成其密钥对，密钥对的保存路径使用缺省的 /home/caoyuz/.ssh/id_rsa, 要求输入 passphrase 的时候，直接回车。这样生成的证书以及公钥将存储在 /home/caoyuz/.ssh 目录，形成两个文件 id_rsa，id_rsa.pub。然后将 id_rsa.pub 文件的内容复制到每一台机器(包括本机 homer06)的　 /home/caoyuz/.ssh/authorized_keys　文件的尾部，如果机器上不存在　 /home/caoyuz/.ssh/authorized_keys 文件，可以自行创建一个。请注意 id_rsa.pub 文件的内容是长长的一行，复制时需注意，不要遗漏字符或混入了多余换行符。</p>
<p>接下来可以做一下 SSH 连接测试，从 homer06 分别向 homer06, homer07, homer08 发起 SSH 连接请求，确保不需要输入密码就能 SSH 连接成功。注意第一次 SSH 连接时会出现如下提示信息：</p>
<p>The authenticity of host [homer06] can't be established. The key fingerprint is: 74:32:91:f2:9c:dc:2e:80:48:73:d4:53:ab:e4:d3:1a Are you sure you want to continue connecting (yes/no)?</p>
<p>请输入 yes, 这样 OpenSSH 会把连接过来的这台主机的信息自动加到 /home/caoyuz/.ssh/know_hosts 文件中去，第二次再连接时，就不会有这样的提示信息了。</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2009/05/23/ssh-without-typing-passwd.html" data-id="cj4nt09ii002iusa6fhr4n87j" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-linux-hard-link" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/05/06/linux-hard-link.html" class="article-date">
  <time datetime="2009-05-06T07:45:00.000Z" itemprop="datePublished">2009-05-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/05/06/linux-hard-link.html">Linux hard link</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>You may confused what the hard link is, and why the delete file use the unlink(2) system call. this example will help you somehow.</p>
<p>assumption, there is a file in /tmp/a.txt</p>
<p>$ cat /tmp/a.txt<br>hello, i'm a.txt</p>
<p>then, we write this test.c<br>test.c:
<div style="text-align: justify;"><span style="font-family: lucida grande;">#include &lt;unistd.h&gt;</span><br><span style="font-family: lucida grande;">int main(void)</span><br><span style="font-family: lucida grande;">{</span><br><span style="font-family: lucida grande;">    link("/tmp/a.txt", "/tmp/new_a.txt");</span><br><span style="font-family: lucida grande;">    /* in this moment, the a.txt have same content with new_a.txt */</span><br><span style="font-family: lucida grande;">    unlink("/tmp/a.txt");</span><br><span style="font-family: lucida grande;">   /* in this moment, a.txt will be delete */</span><br><span style="font-family: lucida grande;">}</span></div>
</p><p>we compile the test.c<br>$gcc test.c</p>
<p>and run it<br>$./a.out</p>
<p>$ cat /tmp/new_a.txt<br>hello, i'm a.txt</p>
<p>Use hard link is the simplest and the fastest way move files within the same filesystem, since hard link cann't across filesystem.</p>
<p>More infomation you need check the link(2) or the unix filesystem design.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2009/05/06/linux-hard-link.html" data-id="cj4nt09ig002gusa61c8i65v3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-%e4%bd%bf%e7%94%a8libjpeg%e7%9b%b4%e6%8e%a5%e8%bd%ac%e6%8d%a2yuv420%e5%9b%be%e5%83%8f%e5%88%b0jpeg" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2009/04/03/%e4%bd%bf%e7%94%a8libjpeg%e7%9b%b4%e6%8e%a5%e8%bd%ac%e6%8d%a2yuv420%e5%9b%be%e5%83%8f%e5%88%b0jpeg.html" class="article-date">
  <time datetime="2009-04-02T23:06:00.000Z" itemprop="datePublished">2009-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2009/04/03/%e4%bd%bf%e7%94%a8libjpeg%e7%9b%b4%e6%8e%a5%e8%bd%ac%e6%8d%a2yuv420%e5%9b%be%e5%83%8f%e5%88%b0jpeg.html">使用libjpeg直接转换YUV420图像到JPEG</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><span style="font-family: arial;">这篇文章主要介绍如何把yuv420的图像（当然也可以是422p的图像，但是如果不是planner格式的YUV数据，就不能直接作转换）用libjpeg转换成jpeg的图像。在网上看到许多介绍如何压缩jpeg图像的文章都是通过现把yuv数据转换成rgb格式，然后再通过libjpeg来压缩。但是jpeg内部是基于yuv的颜色空间的，所以这样会进行2次多余的颜色空间转换，这些都是不必要的。</span></p>
<p><span style="font-family: arial;">看了jpeg的spec以后和libjpeg,还有mjpg-streamer的代码以后，自己尝试作一个能够转换的小程序。 现在把这个程序贡献出来给大家作为参考，有兴趣的可以下来代码看看， 100多行代码，很简单的。</span></p>
<p><span style="font-family: arial;">source code: http://sites.google.com/site/kzjeef/files/still.bz2?attredirects=0</span></p>
<p><span style="font-family: courier new;">$ tar jxvf still.bz2</span><br><span style="font-family: courier new;">$ cd yuv2jpg</span><br><span style="font-family: courier new;">$ make</span></p>
<p><span style="font-family: arial;">建议先阅读 README, 经过转换的图像放在/tmp/still.jpg </span></p>
<p><span style="font-family: arial;">谢谢。</span></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2009/04/03/%e4%bd%bf%e7%94%a8libjpeg%e7%9b%b4%e6%8e%a5%e8%bd%ac%e6%8d%a2yuv420%e5%9b%be%e5%83%8f%e5%88%b0jpeg.html" data-id="cj4nt09id002cusa6acv9bd2e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-about-prelink-enable-prelink-in-unbuntu" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2008/11/09/about-prelink-enable-prelink-in-unbuntu.html" class="article-date">
  <time datetime="2008-11-08T20:50:00.000Z" itemprop="datePublished">2008-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/11/09/about-prelink-enable-prelink-in-unbuntu.html">About Prelink &amp; Enable prelink in Unbuntu</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p style="font-family:arial;"> <span style="font-size:130%;"><span class="header">What is Prelinking?</span></span></p>
<p face="arial">
<blockquote><p face="arial">Prelinking is a process that allows you to speed up the process of dynamic  linking. What it does is, through a process of magic that is incredibly  complex, but basically  it speeds up the relocation process, in loading   shared libraries.. by setting preferred load addresses.</p>
<p face="arial">What is he talking about, you ask? Well, here's how it goes. Dynamically linked libraries (often referred to as DSO's or in the windows world DLLs) are libraries which are loaded at runtime. The advantage of shared libraries versus static libraries is, that it reduces the size of executables, since each program doesn't need its libraries built in, but will dynamically locate and use it at run time. This adds some overhead, because the address space of the library, instead of being known in advance, has to be mapped at runtime. Another advantage of shared libraries is that due to the magic of copy-on-write, you can save memory when you have multiple programs sharing the same library (though it's not as simple as that.. it is pretty complicated) </p>
<p style="font-family: arial;"> Pre-linking sets preferred address space for the libraries to be loaded at. Note they are _preferred_ spaces, and if that address space is not available, then it will use relocation to load it dynamically.. hence pre-linking is not 100% foolproof.<span style="font-weight: bold;font-size:130%;" class="header"><br></span></p>
<p style="font-family: arial;"><span style="font-weight: bold;font-size:130%;" class="header"></span></p>
<blockquote></blockquote>
<p>What do I need to prelink?<br>
<blockquote></blockquote>
</p><p style="font-family: arial;">To prelink, you need at least:<br>- glibc 2.3.1 or greater<br>- libelf or elfutils 0.7, though 0.8 is preferred. Latest version as of this writing is 0.84<br>- Your shared libraries have to be compiled with -fPIC<br>- the prelink program from <a href="ftp://people.redhat.com/jakub/prelink" target="_blank" rel="external">ftp://people.redhat.com/jakub/prelink</a></p>
</blockquote>
</p><p style="font-family: arial;"><a href="ftp://people.redhat.com/jakub/prelink" target="_blank" rel="external"></a> </p>
<p><sp style="font-family:arial;"><span style="font-size:130%;"><br><span style="font-weight: bold;">HOWTO: Enable prelink</span></span></sp></p>
<p>Prelink is in universe. I use it on my Ubuntu system without issues, but do google about Prelink and do your research before trying it out.</p>
<p>How to enable prelink:</p>
<p>1. Activate Ubuntu universe sources. The procedure is well-documented by Ubuntu.<br>2. use apt-get or synaptic to install prelink.<br>3. Open /etc/default/prelink with your favorite editor, as sudo/root.<br>4. Change PRELINKING=unknown from unknown to yes.<br>5. Adjust the other options if you know what the heck you're doing. Defaults work well.<br>6. To start the first prelink (the longest one!), run sudo /etc/cron.daily/prelink</p>
<p>In the future, prelink performs a quick prelink (a less-than-1-minute procedure on most systems) daily, usually at midnight. Every 14 days, or whatever you changed it to be, a full prelink will run.</p>
<p>If you just did a major apt-get upgrade that changed systemwide libraries (i.e. libc6, glibc, major gnome/X libs, etc etc etc) and experience cryptic errors about libs, rerun step 6.</p>
<p>To undo prelink, change step 4 from yes to no, then rerun step 6.</p>
<p>WARNING:<br>An amd64 users in another thread (http://ubuntuforums.org/showpost.php...3&postcount;=16) reports having experienced trouble with AMD64 prelinking. I have NOT tried prelinking on anything other than an i386!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2008/11/09/about-prelink-enable-prelink-in-unbuntu.html" data-id="cj4nt09ie002eusa6w0ei6arr" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-%e7%a7%bb%e6%a4%8d-tslib-%e5%88%b0android-%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2008/11/05/%e7%a7%bb%e6%a4%8d-tslib-%e5%88%b0android-%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9.html" class="article-date">
  <time datetime="2008-11-05T06:02:00.000Z" itemprop="datePublished">2008-11-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/11/05/%e7%a7%bb%e6%a4%8d-tslib-%e5%88%b0android-%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9.html">移植 tslib 到Android 的注意事项</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>tslib是这样的结构， tslib只是一个上层， 他主要是调用它的那些插件来处理从驱动那里得到的点，<br>插件的顺序是你的 ts.conf 里面的插件的顺序。<br>昨天发现能够从/dev/input/event1里面读出东西来， 却不能够用ts_test来响应，原来是驱动送上来的点不符合规则， （更搞笑的是他还没意识到这点， 坚持说自己是对的）， 我用的插件是 input 插件， 找到问题以后就好办了， 改configure.ac里面， 给自己加一个插件， 就叫ac97吧， 然后创建文件 tslib_src/plugins/ac97-raw.c ， 把你“特殊”的驱动加进去就可以了。</p>
<p>测试的时候， 发现很慢， 奇怪驱动送上来的点是很快的啊， 结果发现是因为我在读入每个点之后都打印了调试信息， 所以导致tslib的延迟， 如果你的系统也存在同样的问题， 最好去掉debug试一试， 毕竟终端是比较慢的设备。</p>
<p>其实把tslib放入Android里面首先要解决的问题是Android的编译系统， 你要把tslib， 和那些你用到的插件们都编译成动态库的形式， 可以参考其他库的Android.mk文件来编写， 还有就是你要把ts_test, ts_calebrate编译成可执行文件， 同样是编写Android.mk。</p>
<p>因为Android是从/dev/input/event0读入鼠标事件， 我们的想法就是不要去改动他的代码， 在后台运行一个daemon， 它就是把 /dev/input/event1中读出来的坐标（经过校准的），inject到event0里面， 这样一来就可以不修改Android的代码， 而加入我们的东西。<br>我在想， 要不要把tslib的东西checkin到Android的baseline中呢。 这是一个好想法。 毕竟不是所有人都用电容触摸屏的。</p>
<p>移植进入Android里面可能会有这样的问题， 就是点击触摸屏和键盘会没有反应， 其实这是因为电源管理相关的东西导致的， 如果你也遇到同样的问题， 那么请屏蔽掉 _android_src_/hardware/libhardware/power.c中的函数（关键是最后一个函数， 函数名我忘了呵呵）。</p>
<p>PS：fprintf到stderr上严重影响性能， 用打log调试确实不是一个好的方法， 在tiny loop和相应用户事件的地方不要大量的打log， 这也是为什么让我体会到了Android中的logger设备的优点啊。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2008/11/05/%e7%a7%bb%e6%a4%8d-tslib-%e5%88%b0android-%e7%9a%84%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9.html" data-id="cj4nt09ic002ausa6ftjzvuqj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-android-eabi-lib" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2008/10/21/android-eabi-lib.html" class="article-date">
  <time datetime="2008-10-21T08:18:00.000Z" itemprop="datePublished">2008-10-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/10/21/android-eabi-lib.html">android eabi lib</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Android SDK里面所带的二进制库生成全部是EABI兼容的， 那么什么是EABI？ 对<br>我们有什么意义呢？</p>
<p>1.这里现介绍一下什么是EABI（Embedded Application Binary Interface）</p>
<p>      EABI最早是从powerPC 在 UNIX V5 的ABI（Application Binary<br>      Interface）的补充的基础上构建的， 他的木表示减少内存使用和优化执<br>      行速度， 而且这些都是特别针对于嵌入式系统软件的。<br>      EABI规定了一下几个内容：<br>            * 文件的格式<br>            * 数据类型和对齐<br>            * 寄存器用法的规定<br>            * 堆栈布局和组织<br>            * 函数参数传递顺序<br>            * 小数据区域(data area)的用法和组织</p>
<p>2. 对我们有什么意义呢？<br>      EABI兼容的二进制库除了在速度上有所优化以外， 它还保证了一样东<br>      西。<br>      就是让软件开发着可以混合使用EABI兼容的不同厂商之间的二进制库，<br>      只要他们是EABI兼容的， 并且开发者的软件也是用EABI兼容的编译起编<br>      译的， 就可以正确的一起使用。</p>
<p>      这样， 我们就可以在不能拿到代码， 或者是专门为本平台编译过的二进<br>      制库的情况下来使用这些二进制库。</p>
<p>      就近来讲， 就是Android SDK 里面带的.so文件， 有一些我们可以不必<br>      要拿到代码，或者重新编译。 但是为了能够正确的使用这些库。 可能还<br>      是需要一些支持工作。 比如这些库和驱动之间的接口之类的。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2008/10/21/android-eabi-lib.html" data-id="cj4nt09ib0028usa6a5l75ic6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-leaving-hometown" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2008/07/10/leaving-hometown.html" class="article-date">
  <time datetime="2008-07-10T15:06:00.000Z" itemprop="datePublished">2008-07-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/未分类/">未分类</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2008/07/10/leaving-hometown.html">leaving hometown</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>5号到家，11号走，没在家住几天。就要去公司了，今天和同学吃了个饭以后发现大家都是各走各的路了，包括今天早上想联系王志平也联系不上。大学真的是一散就真的散了。 看到他在博客里写走的那天窗户只开了一点点小窗户的感觉真的很伤心。我不懂这些礼仪这些的，我认为只要心意在那里就可以了，可是我知道我错了，有时候会伤了别人的心。</p>
<p>今天家里的叔叔姑姑们给我和龙哥饯行，喝酒的时候我很后悔在毕业饭的时候没有喝多，回去还那么清醒。现在距离才多长时间，兄弟们都已经天南地北各奔东西了。现在我只能说，兄弟走好。。。多联系。</p>
<p>Different life, not same world, not same dream!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.thinksrc.com/2008/07/10/leaving-hometown.html" data-id="cj4nt09ia0026usa6fyc31r6l" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/8/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CPU/">CPU</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/CPU/未分类/">未分类</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Emacs/">Emacs</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Emacs/Throughs/">Throughs</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Performance/">Performance</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rails/">Rails</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Rails/未分类/">未分类</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/GAE/">GAE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GFW/">GFW</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Postgres/">Postgres</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Rails/">Rails</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/adb/">adb</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/android/">android</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/apple/">apple</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/arm/">arm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bluetooth/">bluetooth</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/emacs/">emacs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/go/">go</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/google/">google</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homebrew/">homebrew</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/internet/">internet</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/kindle/">kindle</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux-优化/">linux 优化</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mac/">mac</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/pm/">pm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/uart/">uart</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/">ubuntu</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/性格/">性格</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/电子商务/">电子商务</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/GAE/" style="font-size: 10px;">GAE</a> <a href="/tags/GFW/" style="font-size: 15px;">GFW</a> <a href="/tags/Postgres/" style="font-size: 10px;">Postgres</a> <a href="/tags/Rails/" style="font-size: 10px;">Rails</a> <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/android/" style="font-size: 17.5px;">android</a> <a href="/tags/apple/" style="font-size: 10px;">apple</a> <a href="/tags/arm/" style="font-size: 10px;">arm</a> <a href="/tags/bluetooth/" style="font-size: 12.5px;">bluetooth</a> <a href="/tags/emacs/" style="font-size: 12.5px;">emacs</a> <a href="/tags/git/" style="font-size: 10px;">git</a> <a href="/tags/go/" style="font-size: 10px;">go</a> <a href="/tags/google/" style="font-size: 10px;">google</a> <a href="/tags/homebrew/" style="font-size: 10px;">homebrew</a> <a href="/tags/internet/" style="font-size: 10px;">internet</a> <a href="/tags/kindle/" style="font-size: 10px;">kindle</a> <a href="/tags/linux/" style="font-size: 20px;">linux</a> <a href="/tags/linux-优化/" style="font-size: 10px;">linux 优化</a> <a href="/tags/mac/" style="font-size: 10px;">mac</a> <a href="/tags/pm/" style="font-size: 10px;">pm</a> <a href="/tags/uart/" style="font-size: 10px;">uart</a> <a href="/tags/ubuntu/" style="font-size: 10px;">ubuntu</a> <a href="/tags/性格/" style="font-size: 10px;">性格</a> <a href="/tags/电子商务/" style="font-size: 10px;">电子商务</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/05/">May 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/03/">March 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/10/">October 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/09/">September 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/06/">June 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/05/">May 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/06/">June 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2013/01/">January 2013</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/12/">December 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/11/">November 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/07/">July 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/03/">March 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2012/02/">February 2012</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/12/">December 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/10/">October 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/09/">September 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/08/">August 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/07/">July 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/06/">June 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/05/">May 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/04/">April 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2011/03/">March 2011</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/12/">December 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/11/">November 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/08/">August 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/07/">July 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/06/">June 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/05/">May 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/04/">April 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2010/03/">March 2010</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/11/">November 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/09/">September 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/05/">May 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2009/04/">April 2009</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/11/">November 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/10/">October 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/07/">July 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/03/">March 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/02/">February 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2008/01/">January 2008</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/12/">December 2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/11/">November 2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/10/">October 2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/09/">September 2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/08/">August 2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/07/">July 2007</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2007/06/">June 2007</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/05/26/about-java-native-programmingjni-local-reference.html">About Java Native Programming(JNI) Local Reference</a>
          </li>
        
          <li>
            <a href="/2016/03/18/write-async-test-case-by-gtest-gmock-for-c.html">Write Async Test Case by gtest &amp; gmock for C++</a>
          </li>
        
          <li>
            <a href="/2015/12/06/understanding-the-stack-frame.html">Understanding the function call and recursion ...</a>
          </li>
        
          <li>
            <a href="/2015/10/04/art-of-padding.html">Art of padding</a>
          </li>
        
          <li>
            <a href="/2015/09/30/%e6%8e%a8%e8%8d%90%e4%b8%80%e4%b8%aa%e7%94%bbuml%e5%88%a9%e5%99%a8-plantuml.html">推荐一个画UML利器 - PlantUML</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Jiejing Zhang<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>